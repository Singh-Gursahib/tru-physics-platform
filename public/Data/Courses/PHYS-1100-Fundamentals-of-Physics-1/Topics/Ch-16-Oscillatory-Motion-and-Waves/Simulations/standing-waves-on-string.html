<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PHYS1100 | Standing Waves on a String</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --teal-main: #0f766e;
      --teal-soft: #14b8a6;
      --bg-soft: #f1f5f9;
      --bg-card: #ffffff;
      --slate-soft: #6b7280;
      --slate-deep: #0f172a;
      --accent-gold: #f59e0b;
      --node-color: #0f172a;
      --antinode-color: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, -sans-serif;
      background:
        radial-gradient(circle at top left, #eff6ff 0, #e0f7f5 26%, #f9fafb 68%, #eef2ff 100%);
      color: var(--slate-deep);
      overflow: hidden;
    }

    .layout-root {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items:stretch;
      gap: 1.5rem;
      padding: 1.5rem;
      width: 100vw;
      height: 100vh;
    }

    /* LEFT PANEL - Light Teal */
    .teal-panel {
      width: 340px;
      max-width: 360px;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.14), transparent 70%),
        linear-gradient(
          180deg,
          rgba(240, 253, 250, 1),
          rgba(224, 242, 254, 1)
        );
      border-radius: 1.2rem;
      padding: 1.1rem 1.25rem 0.9rem;
      box-shadow:
        0 16px 34px rgba(15, 23, 42, 0.16),
        0 0 22px rgba(148, 163, 253, 0.18);
      border: 1px solid rgba(148, 163, 253, 0.16);
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      overflow-y: auto;
      position: relative;
    }

    .teal-panel::-webkit-scrollbar {
      width: 6px;
    }
    .teal-panel::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 253, 0.55);
      border-radius: 999px;
    }

    .panel-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(15, 118, 110, 0.24);
      background: rgba(240, 253, 250, 0.98);
      font-size: 0.63rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--teal-main);
    }

    .panel-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.8);
    }

    .panel-title {
      font-size: 1.14rem;
      font-weight: 700;
      color: #064e3b;
      letter-spacing: 0.01em;
      margin-top: 0.1rem;
    }

    .panel-subtitle {
      font-size: 0.74rem;
      color: #065f46;
      line-height: 1.4;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.35rem;
      margin-top: 0.1rem;
    }

    .info-card {
      padding: 0.35rem 0.5rem;
      border-radius: 0.65rem;
      background: rgba(248, 250, 252, 0.98);
      border: 1px solid rgba(148, 163, 253, 0.18);
      display: flex;
      flex-direction: column;
      gap: 0.06rem;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.03);
      font-size: 0.6rem;
    }

    .info-label {
      font-size: 0.58rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
    }

    .info-value {
      font-size: 0.84rem;
      font-weight: 600;
      color: #111827;
    }

    .info-sub {
      font-size: 0.6rem;
      color: #9ca3af;
    }

    .equations-block {
      margin-top: 0.16rem;
      padding: 0.42rem 0.55rem;
      border-radius: 0.75rem;
      background: rgba(248, 250, 252, 0.98);
      border: 1px solid rgba(148, 163, 253, 0.26);
      display: flex;
      flex-direction: column;
      gap: 0.16rem;
      font-size: 0.66rem;
      color: #065f46;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.04);
    }

    .equations-block code {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas;
      font-size: 0.63rem;
      padding: 0.02rem 0.22rem;
      border-radius: 0.25rem;
      background: #ecfeff;
      color: #0f766e;
    }

    .highlight-box {
      padding: 0.22rem 0.32rem;
      border-radius: 0.45rem;
      background: rgba(22, 163, 74, 0.04);
      border-left: 2px solid rgba(22, 163, 74, 0.9);
    }

    .mode-buttons {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 0.28rem;
      margin-top: 0.32rem;
    }

    .mode-btn {
      border-radius: 999px;
      padding: 0.22rem 0.1rem;
      font-size: 0.65rem;
      text-align: center;
      border: 1px solid rgba(148, 163, 253, 0.6);
      background: rgba(239, 246, 255, 0.98);
      color: #4b5563;
      cursor: pointer;
      transition: all 0.16s ease;
      user-select: none;
    }

    .mode-btn.active {
      background: linear-gradient(to right, #14b8a6, #0f766e);
      color: #ecfeff;
      border-color: rgba(22, 163, 74, 0.98);
      box-shadow: 0 4px 10px rgba(15, 118, 110, 0.4);
      font-weight: 600;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.3rem;
    }

    .primary-btn,
    .ghost-btn,
    .outline-pill {
      border-radius: 999px;
      font-size: 0.67rem;
      padding: 0.22rem 0.7rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      transition: all 0.18s ease;
      white-space: nowrap;
    }

    .primary-btn {
      background: linear-gradient(to right, #14b8a6, #0f766e);
      color: #ecfeff;
      font-weight: 600;
      box-shadow: 0 4px 14px rgba(15, 118, 110, 0.32);
    }

    .primary-btn:hover {
      box-shadow: 0 6px 18px rgba(15, 118, 110, 0.4);
      transform: translateY(-1px);
    }

    .ghost-btn {
      background: rgba(239, 246, 255, 0.98);
      color: #0f766e;
      border: 1px solid rgba(148, 163, 253, 0.6);
      font-weight: 500;
    }

    .ghost-btn:hover {
      background: #eff6ff;
      box-shadow: 0 3px 9px rgba(148, 163, 253, 0.3);
    }

    .outline-pill {
      background: transparent;
      color: #6b7280;
      border: 1px dashed rgba(148, 163, 253, 0.85);
      padding-inline: 0.5rem;
    }

    .outline-pill span.key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid rgba(148, 163, 253, 0.9);
      font-size: 0.55rem;
      color: #4b5563;
      margin-right: 0.16rem;
    }

    /* RIGHT SIDE - Canvas and panels */
    .sim-container {
      flex: 1;
      min-width: 820px;
      max-width: 1120px;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .sim-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .sim-title-block {
      display: flex;
      flex-direction: column;
      gap: 0.08rem;
    }

    .sim-title {
      font-size: 1.05rem;
      font-weight: 600;
      color: #0f172a;
    }

    .sim-subtitle {
      font-size: 0.74rem;
      color: #6b7280;
    }

    .sim-legend {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.66rem;
      color: #6b7280;
      flex-wrap: wrap;
    }

    .legend-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      margin-right: 0.2rem;
    }

    .canvas-shell {
      background:
        radial-gradient(circle at top, #eff6ff, #ffffff 60%);
      border-radius: 1.1rem;
      padding: 0.7rem 0.9rem 0.6rem;
      box-shadow:
        0 14px 30px rgba(148, 163, 253, 0.18),
        0 0 22px rgba(148, 163, 253, 0.12);
      border: 1px solid rgba(148, 163, 253, 0.24);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .canvas-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.64rem;
      color: #6b7280;
      flex-wrap: wrap;
    }

    .toolbar-left,
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .pill-soft {
      padding: 0.16rem 0.55rem;
      border-radius: 999px;
      background: rgba(239, 246, 255, 0.98);
      border: 1px solid rgba(148, 163, 253, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.6rem;
      color: #6b7280;
    }

    #p5-root {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @media (max-width: 1100px) {
      body {
        overflow-y: auto;
      }
      .layout-root {
        flex-direction: column;
        height: auto;
      }
      .teal-panel {
        width: 100%;
        max-width: 900px;
        max-height: 380px;
      }
      .sim-container {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="layout-root">
  <!-- LEFT: Physics + Controls -->
  <aside class="teal-panel">
    <div class="panel-pill">
      <span class="dot"></span>
      PHYS1100 · Ch 16 · Standing Waves
    </div>
    <div class="panel-title">Standing Waves on a String</div>
    <div class="panel-subtitle">
      Visualize harmonics on a string fixed at both ends. Select a mode number m to see nodes, antinodes,
      and how wavelength and frequency follow
      <strong>λₘ = 2L/m</strong> and <strong>fₘ = m·f₁</strong>.
    </div>

    <!-- Key values -->
    <div class="info-grid">
      <div class="info-card">
        <div class="info-label">String length</div>
        <div class="info-value">
          L = <span id="L-label">1.00</span> m
        </div>
        <div class="info-sub">Fixed between two rigid supports</div>
      </div>
      <div class="info-card">
        <div class="info-label">Wave speed</div>
        <div class="info-value">
          v = <span id="v-label">120</span> m/s
        </div>
        <div class="info-sub">Set by tension + linear density</div>
      </div>
      <div class="info-card">
        <div class="info-label">Fundamental</div>
        <div class="info-value">
          f₁ = <span id="f1-label">60.0</span> Hz
        </div>
        <div class="info-sub">m = 1 mode</div>
      </div>
      <div class="info-card">
        <div class="info-label">Current mode</div>
        <div class="info-value">
          m = <span id="mode-label">1</span>
        </div>
        <div class="info-sub">
          Antinodes: <span id="antinodes-label">1</span>
        </div>
      </div>
    </div>

    <!-- Equations -->
    <div class="equations-block">
      <div><strong>Allowed Standing-Wave Modes</strong></div>
      <div>
        For a string of length <code>L</code> fixed at both ends, only modes with integer
        <code>m = 1, 2, 3, ...</code> are allowed.
      </div>
      <div class="highlight-box">
        <div>Wavelength for mode m:</div>
        <div><code>λₘ = 2L / m</code></div>
      </div>
      <div class="highlight-box">
        <div>Frequency for mode m (using v = fλ):</div>
        <div><code>fₘ = m · (v / 2L) = m · f₁</code></div>
      </div>
      <div>
        Each mode has:
        - nodes at fixed ends,
        - m antinodes along the string.
      </div>
    </div>

    <!-- Mode selection -->
    <div class="mode-buttons">
      <div class="mode-btn active" data-mode="1">m = 1</div>
      <div class="mode-btn" data-mode="2">m = 2</div>
      <div class="mode-btn" data-mode="3">m = 3</div>
      <div class="mode-btn" data-mode="4">m = 4</div>
      <div class="mode-btn" data-mode="5">m = 5</div>
    </div>

    <!-- Play / options -->
    <div class="btn-row">
      <button id="play-toggle" class="primary-btn">
        <span id="play-icon">▶</span>
        <span id="play-label">Animate Standing Wave</span>
      </button>
      <button id="freeze-nodes" class="ghost-btn">
        Show Static Envelope Only
      </button>
    </div>
    <div class="btn-row">
      <div class="outline-pill">
        <span class="key">Space</span> Play/Pause
      </div>
      <div class="outline-pill">
        <span class="key">←</span><span class="key">→</span> Change m
      </div>
    </div>
  </aside>

  <!-- RIGHT: Visualization -->
  <section class="sim-container">
    <div class="sim-header">
      <div class="sim-title-block">
        <div class="sim-title">Resonant Modes of a String Fixed at Both Ends</div>
        <div class="sim-subtitle">
          The blue curve shows the instantaneous standing wave. The pale band shows the
          maximum envelope. Black dots mark nodes (no motion), and green dots mark antinodes.
          Increase m to see more half-wavelengths fit into the same length L.
        </div>
      </div>
      <div class="sim-legend">
        <span class="flex items-center">
          <span class="legend-dot" style="background:#0f766e;"></span> String / envelope
        </span>
        <span class="flex items-center">
          <span class="legend-dot" style="background:#3b82f6;"></span> Instantaneous shape
        </span>
        <span class="flex items-center">
          <span class="legend-dot" style="background:#111827;"></span> Nodes
        </span>
        <span class="flex items-center">
          <span class="legend-dot" style="background:#22c55e;"></span> Antinodes
        </span>
      </div>
    </div>

    <div class="canvas-shell">
      <div class="canvas-toolbar">
        <div class="toolbar-left">
          <div class="pill-soft">
            Mode:
            <strong>m = <span id="mode-pill">1</span></strong>
            (<span id="antinodes-pill">1</span> antinode)
          </div>
          <div class="pill-soft">
            λₘ =
            <span id="lambda-label" class="font-mono text-emerald-600">2.00</span> m
          </div>
          <div class="pill-soft">
            fₘ =
            <span id="fm-label" class="font-mono text-sky-600">60.0</span> Hz
          </div>
        </div>
        <div class="toolbar-right">
          <div class="pill-soft">
            Only integer m produce standing waves.
            This visualization matches the slide’s sequence of modes.
          </div>
        </div>
      </div>
      <div id="p5-root"></div>
    </div>
  </section>
</div>

<script>
  // Standing wave model:
  // y(x,t) = A * sin(mπx/L) * cos(ω_m t)
  // with m = 1,2,3..., L fixed, v given.
  // λ_m = 2L/m
  // f_m = m v / (2L) = m f1

  const sketch = (p) => {
    const CANVAS_W = 800;
    const CANVAS_H = 420;

    const marginX = 80;
    const region = {
      x: marginX,
      y: 80,
      w: CANVAS_W - 2 * marginX,
      h: 220,
    };

    // Physics parameters
    let L = 1.0;          // meters
    let v = 120.0;        // m/s
    let f1 = v / (2 * L); // fundamental frequency
    let m = 1;            // current mode number
    let A = 0.12;         // amplitude

    // Animation state
    let tSim = 0;
    let running = true;       // Is the animation playing or paused?
    let showDynamic = true;   // Is the dynamic wave being shown, or the static envelope?

    // DOM elements
    let LLabel, vLabel, f1Label;
    let modeLabel, antinodesLabel;
    let modePill, antinodesPill;
    let lambdaLabel, fmLabel;
    let playToggleBtn, playIconSpan, playLabelSpan;
    let freezeBtn;

    p.setup = () => {
      const canvas = p.createCanvas(CANVAS_W, CANVAS_H);
      canvas.parent("p5-root");
      p.frameRate(60);

      // Get DOM references
      LLabel = p.select("#L-label");
      vLabel = p.select("#v-label");
      f1Label = p.select("#f1-label");
      modeLabel = p.select("#mode-label");
      antinodesLabel = p.select("#antinodes-label");
      modePill = p.select("#mode-pill");
      antinodesPill = p.select("#antinodes-pill");
      lambdaLabel = p.select("#lambda-label");
      fmLabel = p.select("#fm-label");
      playToggleBtn = p.select("#play-toggle");
      playIconSpan = p.select("#play-icon");
      playLabelSpan = p.select("#play-label");
      freezeBtn = p.select("#freeze-nodes");

      // Fixed displays
      LLabel.html(L.toFixed(2));
      vLabel.html(v.toFixed(0));
      f1Label.html(f1.toFixed(1));

      // Wire events
      playToggleBtn.mousePressed(togglePlay);
      freezeBtn.mousePressed(toggleFreeze);

      const modeButtons = document.querySelectorAll(".mode-btn");
      modeButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const newM = parseInt(btn.getAttribute("data-mode"), 10);
          setMode(newM);
          modeButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });

      updateModeDerived();
      updateAllButtons();
    };

    function setMode(newM) {
      m = p.constrain(newM, 1, 10);
      updateModeDerived();
    }

    function updateModeDerived() {
      const lambda_m = (2 * L) / m;
      const f_m = m * f1;
      modeLabel.html(m.toString());
      antinodesLabel.html(m.toString());
      modePill.html(m.toString());
      antinodesPill.html(m.toString());
      lambdaLabel.html(lambda_m.toFixed(2));
      fmLabel.html(f_m.toFixed(1));
    }

    // --- FIXED ANIMATION LOGIC ---
    function togglePlay() {
      // If the view is static, pressing play should make it dynamic and start playing.
      if (!showDynamic) {
        showDynamic = true;
        running = true;
      } else {
        // Otherwise, just toggle the play/pause state.
        running = !running;
      }
      updateAllButtons();
    }
    
    function toggleFreeze() {
      showDynamic = !showDynamic;
      // When we switch to the static view, the animation must be paused.
      if (!showDynamic) {
        running = false;
      }
      updateAllButtons();
    }

    function updateAllButtons() {
      // Update the main Play/Pause button based on the 'running' state
      if (running) {
        playIconSpan.html("⏸");
        playLabelSpan.html("Pause Animation");
      } else {
        playIconSpan.html("▶");
        playLabelSpan.html("Animate Standing Wave");
      }
      // Update the secondary button based on the 'showDynamic' state
      if (showDynamic) {
        freezeBtn.html("Show Static Envelope Only");
      } else {
        freezeBtn.html("Show Dynamic Wave");
      }
    }
    // --- END OF FIX ---

    function xToPix(x) {
      return region.x + (x / L) * region.w;
    }

    function yToPix(y) {
      const mid = region.y + region.h / 2;
      const scale = (region.h * 0.45) / A;
      return mid - y * scale;
    }

    function yStanding(x, t) {
      const omega_m = 2 * Math.PI * (m * f1); // 2π f_m
      return A * Math.sin((m * Math.PI * x) / L) * Math.cos(omega_m * t);
    }

    function envelope(x) {
      return Math.abs(A * Math.sin((m * Math.PI * x) / L));
    }

    p.draw = () => {
      p.clear();
      p.background(0, 0, 0, 0);

      // Time only advances if the animation is in a 'running' state.
      if (running) {
        const dt = p.deltaTime / 1000;
        tSim += dt;
      }

      drawStringRegion();
      drawNodesAndAntinodes();
      drawModeLabels();
    };

    function drawStringRegion() {
      p.push();
      // Baseline at y=0
      const midY = region.y + region.h / 2;
      p.stroke(209, 213, 219);
      p.strokeWeight(1);
      p.line(region.x, midY, region.x + region.w, midY);

      // Draw envelope (max displacement)
      p.noFill();
      p.stroke(148, 163, 253, 100); // Made it more transparent
      p.strokeWeight(1.2);
      const steps = 260;
      p.beginShape();
      for (let i = 0; i <= steps; i++) {
        const x = (i / steps) * L;
        const y = envelope(x);
        p.vertex(xToPix(x), yToPix(y));
      }
      p.endShape();
      p.beginShape();
      for (let i = 0; i <= steps; i++) {
        const x = (i / steps) * L;
        const y = -envelope(x);
        p.vertex(xToPix(x), yToPix(y));
      }
      p.endShape();

      // Draw the wave itself, either dynamic or static
      if (showDynamic) {
        // Instantaneous standing wave
        p.noFill();
        p.stroke("#3b82f6");
        p.strokeWeight(2.1);
        p.beginShape();
        for (let i = 0; i <= steps; i++) {
          const x = (i / steps) * L;
          const y = yStanding(x, tSim);
          p.vertex(xToPix(x), yToPix(y));
        }
        p.endShape();
      } else {
        // Static view of the envelope shape at max displacement (t=0)
        p.noFill();
        p.stroke("#3b82f6");
        p.strokeWeight(1.8);
        p.beginShape();
        for (let i = 0; i <= steps; i++) {
          const x = (i / steps) * L;
          const y = A * Math.sin((m * Math.PI * x) / L);
          p.vertex(xToPix(x), yToPix(y));
        }
        p.endShape();
      }

      // Supports at ends
      const supportHeight = 40;
      p.fill(148, 163, 253, 220);
      p.noStroke();
      p.rect(region.x - 8, midY - supportHeight / 2, 8, supportHeight, 3);
      p.rect(region.x + region.w, midY - supportHeight / 2, 8, supportHeight, 3);
      p.pop();
    }

    function drawNodesAndAntinodes() {
      p.push();
      const nodeRadius = 5;
      const antiRadius = 6;

      // Nodes: x_n = n * L/m for n = 0..m
      for (let n = 0; n <= m; n++) {
        const x = (n * L) / m;
        p.fill("#111827");
        p.noStroke();
        p.circle(xToPix(x), yToPix(0), nodeRadius * 2);
      }

      // Antinodes: midpoints between consecutive nodes
      for (let n = 0; n < m; n++) {
        const x = ((2 * n + 1) * L) / (2 * m);
        p.fill("#22c55e");
        p.noStroke();
        p.circle(xToPix(x), yToPix(0), antiRadius * 2);
      }
      p.pop();
    }

    function drawModeLabels() {
      p.push();
      p.textAlign(p.CENTER, p.TOP);
      p.textSize(10);
      p.fill("#6b7280");
      p.noStroke();
      p.text("String length L", region.x + region.w / 2, region.y + region.h + 20);
      p.pop();
    }

    p.keyPressed = () => {
      if (p.key === " ") {
        p.preventDefault();
        togglePlay();
      } else if (p.keyCode === p.RIGHT_ARROW) {
        setMode(m + 1 <= 5 ? m + 1 : 5);
        syncModeButtons();
      } else if (p.keyCode === p.LEFT_ARROW) {
        setMode(m - 1 >= 1 ? m - 1 : 1);
        syncModeButtons();
      }
    };

    function syncModeButtons() {
      const buttons = document.querySelectorAll(".mode-btn");
      buttons.forEach((b) => {
        const val = parseInt(b.getAttribute("data-mode"), 10);
        if (val === m) b.classList.add("active");
        else b.classList.remove("active");
      });
    }
  };

  new p5(sketch);
</script>
</body>
</html>