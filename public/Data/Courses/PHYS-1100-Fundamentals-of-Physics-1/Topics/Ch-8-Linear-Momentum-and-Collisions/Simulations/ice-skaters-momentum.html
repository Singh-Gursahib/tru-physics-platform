<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHYS1100 | Conservation of Momentum</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background-color: #1a202c;
        }
        .p5Canvas {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Custom slider styles */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #2d3748;
            border-radius: 5px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4fd1c5;
            cursor: pointer;
            margin-top: -6px;
        }
        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #4a5568;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #2d3748;
            border-radius: 5px;
        }
        input[type=range]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4fd1c5;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen">

    <div class="flex flex-row w-full max-w-7xl mx-auto p-4 gap-6">

        <!-- Left Sidebar -->
        <div id="sidebar" class="w-1/3 bg-teal-800/90 backdrop-blur-sm p-6 rounded-xl shadow-2xl h-[650px] overflow-y-auto">
            <h1 class="text-3xl font-bold text-teal-200 border-b-2 border-teal-500 pb-2 mb-4">Conservation of Momentum</h1>
            <p class="text-sm text-teal-100 mb-6">Two skaters on frictionless ice push off from each other. Since the initial momentum is zero, the total final momentum must also be zero.</p>

            <!-- Controls -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-teal-200 mb-3">Skater Properties</h2>
                <div class="space-y-4">
                    <div>
                        <label for="massDSlider" class="flex justify-between text-teal-100">David's Mass (m_D) <span id="massDValue" class="font-mono text-white">80 kg</span></label>
                        <input type="range" id="massDSlider" min="40" max="120" value="80" step="1" class="w-full">
                    </div>
                    <div>
                        <label for="massSSlider" class="flex justify-between text-teal-100">Sandra's Mass (m_S) <span id="massSValue" class="font-mono text-white">45 kg</span></label>
                        <input type="range" id="massSSlider" min="30" max="90" value="45" step="1" class="w-full">
                    </div>
                    <div>
                        <label for="vFinalSSlider" class="flex justify-between text-teal-100">Sandra's Final Speed (v_Sf) <span id="vFinalSValue" class="font-mono text-white">2.2 m/s</span></label>
                        <input type="range" id="vFinalSSlider" min="0.5" max="5.0" value="2.2" step="0.1" class="w-full">
                    </div>
                </div>
                <div class="flex space-x-2 mt-5">
                    <button id="pushBtn" class="bg-teal-500 hover:bg-teal-400 text-teal-900 font-bold py-2 px-4 rounded-lg w-full transition-colors">Push Off</button>
                    <button id="resetBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg w-full transition-colors">Reset</button>
                </div>
            </div>

            <!-- Physics Formulas -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-teal-200 mb-3">Governing Equations</h2>
                <div class="bg-teal-900/50 p-4 rounded-lg space-y-2 text-teal-100 font-mono text-sm">
                    <p>Pᵢ = m_D·v_Di + m_S·v_Si = 0</p>
                    <p>P_f = m_D·v_Df + m_S·v_Sf</p>
                    <p>Pᵢ = P_f  &rarr;  0 = m_D·v_Df + m_S·v_Sf</p>
                    <p>v_Df = - (m_S·v_Sf) / m_D</p>
                </div>
            </div>
            
            <!-- Calculated Values -->
            <div>
                <h2 class="text-xl font-semibold text-teal-200 mb-3">Calculated Results</h2>
                <div class="bg-teal-900/50 p-4 rounded-lg space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-teal-100">David's Final Velocity (v_Df):</span>
                        <span id="vFinalDResult" class="font-mono text-xl text-white">-1.24 m/s</span>
                    </div>
                     <hr class="border-teal-700">
                    <div class="flex justify-between items-center">
                        <span class="text-teal-100">David's Momentum (p_D):</span>
                        <span id="momentumDResult" class="font-mono text-lg text-white">-99.0 kg·m/s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-teal-100">Sandra's Momentum (p_S):</span>
                        <span id="momentumSResult" class="font-mono text-lg text-white">+99.0 kg·m/s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Simulation Canvas -->
        <div id="canvas-container" class="w-2/3 flex flex-col items-center justify-center">
             <!-- p5.js canvas will be inserted here -->
        </div>

    </div>

    <script>
        // Global p5.js sketch
        const sketch = (p) => {
            // DOM Elements
            let massDSlider, massSSlider, vFinalSSlider;
            let massDValue, massSValue, vFinalSValue;
            let vFinalDResult, momentumDResult, momentumSResult;
            let pushBtn, resetBtn;

            // Physics & Sim Variables
            let m_D, m_S, v_Sf, v_Df;
            let p_D, p_S;

            // Animation State
            let simState = 'idle'; // 'idle', 'moving'
            
            // Skater objects
            let david, sandra;
            const skaterBodyHeight = 80;
            const skaterBodyWidth = 30;
            const skaterHeadRadius = 15;

            p.setup = () => {
                let canvas = p.createCanvas(800, 600);
                canvas.parent('canvas-container');
                p.frameRate(60);

                // --- Connect to DOM ---
                massDSlider = p.select('#massDSlider');
                massSSlider = p.select('#massSSlider');
                vFinalSSlider = p.select('#vFinalSSlider');

                massDValue = p.select('#massDValue');
                massSValue = p.select('#massSValue');
                vFinalSValue = p.select('#vFinalSValue');
                
                vFinalDResult = p.select('#vFinalDResult');
                momentumDResult = p.select('#momentumDResult');
                momentumSResult = p.select('#momentumSResult');

                pushBtn = p.select('#pushBtn');
                resetBtn = p.select('#resetBtn');

                // --- Event Listeners ---
                massDSlider.input(updateAll);
                massSSlider.input(updateAll);
                vFinalSSlider.input(updateAll);
                
                pushBtn.mousePressed(startPushOff);
                resetBtn.mousePressed(resetSimulation);

                // --- Initialize Objects ---
                david = { x: p.width / 2 - 20, y: p.height / 2, vx: 0, color: p.color(239, 68, 68) }; // Red
                sandra = { x: p.width / 2 + 20, y: p.height / 2, vx: 0, color: p.color(59, 130, 246) }; // Blue
                
                // --- Initial Calculation ---
                updateAll();
            };

            p.draw = () => {
                drawIceRink();
                
                updateSkaters();
                
                drawSkater(david, "David");
                drawSkater(sandra, "Sandra");

                if (simState === 'moving') {
                    drawMomentumVectors();
                }

                drawTotalMomentumDisplay();
            };
            
            // --- MAIN LOGIC FUNCTIONS ---
            
            function updateSkaters() {
                if (simState === 'moving') {
                    david.x += david.vx;
                    sandra.x += sandra.vx;

                    // Reset if they go off screen
                    if (david.x < -50 || sandra.x > p.width + 50) {
                        resetSimulation();
                    }
                }
            }
            
            function updateCalculations() {
                m_D = parseFloat(massDSlider.value());
                m_S = parseFloat(massSSlider.value());
                v_Sf = parseFloat(vFinalSSlider.value());

                // Conservation of Momentum: v_Df = - (m_S * v_Sf) / m_D
                v_Df = - (m_S * v_Sf) / m_D;
                
                // Calculate momenta
                p_D = m_D * v_Df;
                p_S = m_S * v_Sf;

                // Update display
                massDValue.html(`${m_D} kg`);
                massSValue.html(`${m_S} kg`);
                vFinalSValue.html(`${v_Sf.toFixed(1)} m/s`);
                
                vFinalDResult.html(`${v_Df.toFixed(2)} m/s`);
                momentumDResult.html(`${p_D.toFixed(1)} kg·m/s`);
                momentumSResult.html(`${p_S.toFixed(1)} kg·m/s`);
            }
            
            function updateAll() {
                updateCalculations();
                resetSimulation();
            }

            function startPushOff() {
                if (simState === 'idle') {
                    // Set velocities for animation (scaled for visibility)
                    const speedScale = 3;
                    david.vx = v_Df * speedScale;
                    sandra.vx = v_Sf * speedScale;
                    simState = 'moving';
                }
            }

            function resetSimulation() {
                simState = 'idle';
                david.x = p.width / 2 - 20;
                sandra.x = p.width / 2 + 20;
                david.vx = 0;
                sandra.vx = 0;
            }

            // --- DRAWING FUNCTIONS ---

            function drawIceRink() {
                p.background(240, 249, 255); // Light ice blue
                p.stroke(200, 220, 240);
                p.strokeWeight(2);
                p.line(p.width / 2, 0, p.width / 2, p.height); // Center line
            }

            function drawSkater(skater, name) {
                p.push();
                p.translate(skater.x, skater.y);

                // Skates
                p.fill(80);
                p.noStroke();
                p.rect(-skaterBodyWidth/2, skaterBodyHeight/2, skaterBodyWidth, 10, 2);
                p.rect(-skaterBodyWidth/2 + 5, skaterBodyHeight/2 + 10, 5, 20, 2); // Blades
                
                // Body
                p.fill(skater.color);
                p.stroke(p.lerpColor(skater.color, p.color(0), 0.2));
                p.strokeWeight(3);
                p.rectMode(p.CENTER);
                p.rect(0, 0, skaterBodyWidth, skaterBodyHeight, 10);
                
                // Head
                p.fill(255, 224, 189); // Skin tone
                p.stroke(p.lerpColor(skater.color, p.color(0), 0.2));
                p.circle(0, -skaterBodyHeight/2 - skaterHeadRadius + 5, skaterHeadRadius * 2);
                
                // Label
                p.noStroke();
                p.fill(50);
                p.textAlign(p.CENTER);
                p.textSize(14);
                p.text(name, 0, skaterBodyHeight/2 + 40);
                
                p.pop();
            }

            function drawMomentumVectors() {
                // Vector scaling factor to make them look good
                const vectorScale = 0.5;
                const vectorLength = p.abs(p_S * vectorScale); // Lengths are equal!

                // David's vector (points left)
                drawVector(david.x, david.y - 100, david.x - vectorLength, david.y - 100, david.color, 'p_D');
                
                // Sandra's vector (points right)
                drawVector(sandra.x, sandra.y - 100, sandra.x + vectorLength, sandra.y - 100, sandra.color, 'p_S');
            }

            function drawVector(x1, y1, x2, y2, color, label) {
                p.push();
                p.stroke(color);
                p.strokeWeight(4);
                p.fill(color);
                p.line(x1, y1, x2, y2);
                
                // Arrowhead
                p.push();
                p.translate(x2, y2);
                let angle = p.atan2(y2 - y1, x2 - x1);
                p.rotate(angle);
                p.triangle(0, 0, -12, -6, -12, 6);
                p.pop();

                // Label
                p.noStroke();
                p.fill(p.lerpColor(color, p.color(0), 0.3));
                p.textSize(16);
                p.textStyle(p.BOLD);
                p.textAlign(p.CENTER, p.BOTTOM);
                p.text(label, (x1 + x2) / 2, y1 - 10);
                
                p.pop();
            }

            function drawTotalMomentumDisplay() {
                p.push();
                p.noStroke();
                p.fill(0, 0, 0, 50);
                p.rect(p.width / 2 - 150, 10, 300, 40, 10);
                
                p.fill(10, 20, 30);
                p.textSize(18);
                p.textAlign(p.CENTER, p.CENTER);
                let totalMomentum = p_D + p_S;
                p.text(`Total Momentum: ${totalMomentum.toFixed(2)} kg·m/s`, p.width / 2, 30);
                p.pop();
            }
        };

        // Start p5.js
        new p5(sketch);
    </script>
</body>
</html>